<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panier</title>
</head>

<body>
    <a href="/front-end/liste-produits.html">Accueil</a>
    <h2>Votre panier</h2>
    <div id="listeArticles"></div>

    <script>
        function moins(id) {
            const inputQuantite = document.getElementById("quantite_" + id);
            if (inputQuantite.value > 1) {
                inputQuantite.value--;
            }
        }

        function plus(id) {
            const inputQuantite = document.getElementById("quantite_" + id);
            inputQuantite.value++;
        }

        // On créé une fonction qui supprime un produit dans notre panier
        // ici data correspond à une chaine de texte contenant l'id du produit et sa couleur séparés avec un '_'
        function supprimer(data) {
            // On split (découpe) le texte à chaque '_' et on met le résultat dans un tableau 
            data = data.split('_');

            // On filtre le panier pour vérifier si les articles ont le même id et la même couleur
            panier = panier.filter(article => {

                // On retourne tous les articles dans le panier sauf celui qu'on veut supprimer
                // (celui qui a le même id et la même couleur n'est pas retourné et disparaît donc du panier)
                if (article.id != data[0] || article.couleur != data[1]) {
                    return article;
                }
            });

            //On stocke le nouveau panier dans le local storage
            localStorage.panier = JSON.stringify(panier);

            //On actuaise avec reload la page
            location.reload();
        }

        //On charge notre panier vide au départ (si aucun produit n'est séléctionné)
        let panier = [];
        if (localStorage.panier) {
            panier = JSON.parse(localStorage.panier);
        }

        // Faire un lien vers le dom a l'aide de get element by id
        let listePanier = document.getElementById('listeArticles');

        panier.forEach(produit => {
            console.log("produit", produit);

            fetch("/api/teddies/" + produit.id)
                .then(function (res) {
                    if (res.ok) {
                        return res.json();
                    }
                })

                // Ensuite pour chaque article qui sera choisi on aura ses caractéristique nom, couleur, qté
                .then(function (data) {
                    console.log("data", data);
                    /*On charge notre panier plein si l'on séléctionne des articles 
                    pour cela on doit créer celui-ci en html à l'aide de createElement*/
                    let articlePanier = document.createElement('div');
                    // je créer en html les données relatives au produit id qté couleur grâce à la propriété innerHTML
                    articlePanier.innerHTML = `<h4>${data.name}</h4>
                    <img style="width: 10rem;" src="${data.imageUrl}" alt="${data.name}"/>
                    <p>Couleur : ${produit.couleur}</p>
                    <div>
                        <p>Quantité :</p>
                        <button class="bt-moins" onclick="moins('${data._id}_${produit.couleur}')">-</button>
                        <input type="text" id="quantite_${data._id}_${produit.couleur}" class="input_quantite" value="${produit.quantite}" readonly/>
                        <button class="bt-plus" onclick="plus('${data._id}_${produit.couleur}')">+</button>
                        <button class="bt-supprimer" onclick="supprimer('${data._id}_${produit.couleur}')">Supprimer</button>
                    </div>
                    <p>Prix : ${data.price}</p>`;

                    listePanier.appendChild(articlePanier);
                })

                .catch(function (error) {
                    console.error("Erreur", error);
                });
        });
    </script>
</body>

</html>