<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produits</title>
</head>

<body>
    <header>
        <a href="/front-end/listProducts.html">Accueil</a>
        <a href="/front-end/cart.html">Panier</a>
    </header>
    <main>
        <section>
            <h2 id="title"></h2>
            <img id="imageUrl" src="" />
            <p id="description"></p>
        </section>

        <h3 id="price"></h3>

        <h3>Couleur</h3>

        <p>
            <select name="colors-list" id="colors"></select>
        </p>

        <h3>Quantité</h3>

        <form>
            <input id="quantite" type="number" min="1" max="10" value="1"> <br />
        </form>

        <button id="ajouter">Ajouter au panier</button>
    </main>
    <footer>

    </footer>

    <script src="./js/product.js"></script>
    <script src="./js/listProducts.js"></script>
    <script src="./js/cart.js"></script>

    <script>
        /* CHARGER LES CLASSES ET TRAITER LA PROMESSE DU PRODUIT */


        //On crée une constante cart qui contient une nouvelle classe cart (panier) 
        //Et une constante ListProducts qui contient une nouvelle calsse 
        const cart = new Cart();
        const products = new ListProducts();

        //On créer les constantes contenant tout ce qui est relatif à notre objet (titre, image, description, prix...)
        const titre = document.getElementById("title");
        const image = document.getElementById("imageUrl");
        const description = document.getElementById("description");
        const price = document.getElementById("price");
        const listeCouleur = document.getElementById("colors");
        const quantite = document.getElementById("quantite");

        // On récupère l'id dans l'url
        const url = new URL(document.location.href);
        const id = url.searchParams.get("id");

        //On charge l'id d'un seul produit à l'aide de la fonction "loadingProduct" avec tout ce qu'il contient
        products.loadingProduct(id)
            .then(product => {
                titre.innerText = product.name;
                image.src = product.imageUrl;
                description.innerText = product.description;
                price.value = product.price;
                price.innerText = "Prix : " + product.price / 100 + " €";

                //On créer une boucle pour afficher les couleurs sous forme de menu déroulant 
                product.colors.forEach(color => {
                    const ligneCouleur = document.createElement("option");
                    ligneCouleur.value = color;
                    ligneCouleur.innerText = color;
                    listeCouleur.appendChild(ligneCouleur);
                });
            });

        //On créer l'évenement au clic ajouter au panier
        const ajouter = document.getElementById("ajouter");

        ajouter.addEventListener('click', event => {
            event.preventDefault();
            const color = listeCouleur.options[listeCouleur.selectedIndex].value;

            /*INSTANCIATION DE L'OBJET AVEC LA CLASSE PRODUCT*/

            /*La constante "selectProduct" contient la classe product qui à pour paramètres un constructor 
            qui contient id, color, name, description, price, image*/
            const selectProduct = new Product(
                id,
                color,
                titre.innerText,
                description.innerText,
                price.value,
                image.src
            );

            /*On ajoute à les produits que l'on choisi à notre panier avec la fonction "addproduct"
            qui prend en paramètres select product qui contient un object product, ainsi que la valeur de la qté*/
            cart.addProduct(selectProduct, quantite.value);

            //Quand on clique sur le bouton "ajouter" le message ci-dessous s'affiche avec le nom du produit choisi
            ajouter.innerText = `L'article ${selectProduct.name} à été ajouté au panier`;

            //Après l'évènement au click le bouton d'ajout revient à l'état initial après 3 secondes 
            setTimeout(() => {
                ajouter.innerText = "Ajouter au panier";
            }, 3000);
        });
    </script>
</body>

</html>